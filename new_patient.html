<!doctype html>

<html lang="en">
<head>
  	<meta charset="UTF-8">
	<title>PatientList</title>
	<meta name=“viewport” content=“width=device-width, intitial-scale=1.0”>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"> 	 
    <script src="https://cdn.firebase.com/js/client/2.4.0/firebase.js"></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
  	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	<link rel="javascript" type="text/javascript" href="bootstrap.min.js">
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"> 
    
    <style>
        #profpic{
            float: left;
            margin-right: 20px;
            width: 15%;
        }
    </style>
    
    <!--FIREBASE-->
    
    
</head>

<body>
	
    	<!--Horizontal Nav Bar at Top, credit to http://www.bootply.com/98314-->
		<nav class="navbar navbar-default" role="navigation">
		  <div class="navbar-header">
		    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		    </button>    
		  </div>
		  <a class="navbar-brand" href="#">MUMS</a>
		  <div class="navbar-collapse collapse">
		    
		    <ul class="nav navbar-nav navbar-right">
            
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Account Settings <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="login.html">Log Out</a></li>
                  <li><a href="#">Delete Account</a></li>
                </ul>
              </li> 
            </ul>
              
		  </div>
		</nav>
	<!--end nav bar-->
    
<br>
    
    <div id="imgHolder"></div>
    <input type="file" id="fileElem" accept="image/*" style="display:none" onchange="handleFiles(this.files)">
    <img id="profpic" src="img/take_new_profpic.png" style="cursor: pointer" alt="Default Profile Picture">
    <br>
    <div id="retake_text" style="display:none">Tap Photo to Retake</div>
    <br>
    <br>
    <br>
    <br>
    
    <input type='text' id='patient_fname' placeholder='First Name'>
    <input type='text' id='patient_lname' placeholder='Last Name'>
    <input type='text' id='location' placeholder='Location'>
    <input type='text' id='known_drug_allergies' placeholder='Known Drug Allergies'>
    <input type='text' id='medical_history' placeholder='Medical History'>
    <button type="button" class="btn btn-success" onclick="add()">Add Note</button>
    
    <script>
        var myDataRef = new Firebase('https://mums.firebaseio.com/');
        var base64data;
      
        function add(){
            var patient_fname = $('#patient_fname').val();
            var patient_lname = $('#patient_lname').val();
            var location = $('#location').val();
            var known_drug_allergies = $('#known_drug_allergies').val();
            var medical_history = $('#medical_history').val();
            myDataRef.push({patient_fname: patient_fname, 
                            patient_lname: patient_lname,
                            location: location,
                            known_drug_allergies: known_drug_allergies,
                            medical_history: medical_history,
                            prof_img: base64data,
                            lastTestRef: "none"
                            });
            alert("added patient");
            //window.location.href='Dashboard.html';
        }
      
    
       //IMAGE PART
        window.URL = window.URL || window.webkitURL;

        var fileSelect = document.getElementById("profpic"),
                fileElem = document.getElementById("fileElem"),
                imgHolder = document.getElementById("imgHolder");

        fileSelect.addEventListener("click", function(e) {
            if (fileElem) {fileElem.click();
            }
            e.preventDefault(); // prevent navigation to "#"
        }, false);

        function handleFiles(files) {
                imgHolder.innerHTML = "";
                $('#fileSelect').hide();
                $('#sendPhoto').toggle();
                var imgCapture = document.createElement("img");
                imgCapture.src = window.URL.createObjectURL(files[0]);
                //img.height = 60;
                imgCapture.onload = function() {
                    window.URL.revokeObjectURL(this.src);
                }
                //imgHolder.appendChild(imgCapture);
                //console.log(imgCapture.src);
                var reader = new window.FileReader();
                reader.readAsDataURL(files[0]);
                reader.onloadend = function()
                {
                    base64data = reader.result;
                    //for Profile.html - instead of base64data, this will be a variable when calling it back
                    $('#profpic').attr("src", base64data);
                    
                };
                $('#retake_text').show();
                return imgCapture;
        }
    
    </script>
        
    
</body>
</html>